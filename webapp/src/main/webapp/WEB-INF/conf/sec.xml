<?xml version="1.0" encoding="UTF-8"?>
<beans:beans 
	xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd">

	<http pattern="/login" security="none" />
	<http pattern="/register" security="none" />
	<http pattern="/doRegister" security="none" />

	<http auto-config="true" use-expressions="true">
		<intercept-url pattern="/user/**"  access="hasRole('ROLE_USER')" />
		<intercept-url pattern="/admin/**" access="hasRole('ROLE_ADMIN')" />
		<form-login 
			login-page="/login" 
			login-processing-url="/doLogin"
			always-use-default-target="true" 
			default-target-url="/index"
			authentication-failure-url="/login?error=error" />
		<csrf disabled="true" />
		<custom-filter ref="customSecurityInterceptor" before="FILTER_SECURITY_INTERCEPTOR" />  
    </http>  

	<authentication-manager alias="customAuthenticationManager">
		<authentication-provider user-service-ref="customUserDetailService">
			<!-- password-encoder hash="md5" / -->
		</authentication-provider>
	</authentication-manager>
	
	<beans:bean id="customUserDetailService" class="web.framework.sec.CustomUserDetailService" />	
	
	<beans:bean id="customSecurityMetadataSource" class="web.framework.sec.CustomSecurityMetadataSource" />
	
    <beans:bean id="customAccessDecisionManager" class="web.framework.sec.CustomAccessDecisionManager" />

	<beans:bean id="customSecurityInterceptor" class="web.framework.sec.CustomSecurityInterceptor">
		<beans:property name="authenticationManager"  ref="customAuthenticationManager" />
		<beans:property name="accessDecisionManager"  ref="customAccessDecisionManager" />
		<beans:property name="securityMetadataSource" ref="customSecurityMetadataSource" />
	</beans:bean>	
	
	<!-- 
	<http pattern="/"             security="none" />
    <http pattern="/index.jsp"    security="none" />
    <http pattern="/login.jsp"    security="none" />
    <http pattern="/login**"      security="none" />
	<http pattern="/allow.jsp"    security="none" />
	<http pattern="/regis.jsp"    security="none" />
	<http pattern="/error.jsp"    security="none" />
	<http pattern="/favicon.ico"  security="none" />
	<http pattern="/resources/**" security="none" />
	
    <http auto-config="true" use-expressions="true">
		<intercept-url pattern="/user/**"  access="hasRole('ROLE_USER')" />
		<intercept-url pattern="/admin/**" access="hasRole('ROLE_ADMIN')" />
		<form-login 
			login-page="/login.jsp" 
			login-processing-url="/login"
			username-parameter="username"
			password-parameter="password" 
			authentication-failure-url="/login.jsp?error=true" 
			always-use-default-target="true" 
			default-target-url="/index" />
		<logout logout-success-url="/index.jsp" />
		<access-denied-handler error-page="/allow.jsp" />
		<session-management></session-management>
		<remember-me />
		<csrf disabled="true"/>
		<custom-filter ref="customSecurityInterceptor" before="FILTER_SECURITY_INTERCEPTOR" />  
    </http>  

	<authentication-manager alias="customAuthenticationManager">
		<authentication-provider user-service-ref="customUserDetailService">
			<password-encoder hash="md5" />
		</authentication-provider>
	</authentication-manager>
	
	<beans:bean id="customUserDetailService" class="web.framework.sec.CustomUserDetailService" />	
	
	<beans:bean id="customSecurityMetadataSource" class="web.framework.sec.CustomSecurityMetadataSource" />
	
    <beans:bean id="customAccessDecisionManager" class="web.framework.sec.CustomAccessDecisionManager" />

	<beans:bean id="customSecurityInterceptor" class="web.framework.sec.CustomSecurityInterceptor">
		<beans:property name="authenticationManager"  ref="customAuthenticationManager" />
		<beans:property name="accessDecisionManager"  ref="customAccessDecisionManager" />
		<beans:property name="securityMetadataSource" ref="customSecurityMetadataSource" />
	</beans:bean>	
-->
</beans:beans>